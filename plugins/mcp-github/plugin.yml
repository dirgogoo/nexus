/**
 * Policies Applied:
 * - Policy 11.1: MCP-First for Claude Tools
 * - Policy 11.4: Document MCP Absence (track needs ≥3 uses)
 * - Policy 3.17: Code documentation
 */

name: "mcp-github"
description: "GitHub MCP for repository operations, issues, pull requests, and code review"
version: "1.0.0"
type: "mcp"

mcp_config:
  server_name: "github"
  prefix: "mcp__github__"
  auto_detect: true
  priority: 13
  availability: "conditional"  # Only if GitHub MCP tools are available

hooks:
  - name: "create-issue"
    description: "Create GitHub issue from task description"
    mcp_tools:
      - "issue_write"  # method: create
    inputs:
      - "owner"
      - "repo"
      - "title"
      - "body"
      - "labels"
    outputs:
      - "issue_url"
      - "issue_number"
    workflow_phases:
      - "plan"
      - "review"
    validation:
      mandatory: false

  - name: "create-pr"
    description: "Create pull request after implementation complete"
    mcp_tools:
      - "create_pull_request"
      - "update_pull_request"  # for adding reviewers
    inputs:
      - "owner"
      - "repo"
      - "title"
      - "body"
      - "base"
      - "head"
      - "reviewers"
    outputs:
      - "pr_url"
      - "pr_number"
    workflow_phases:
      - "review"
    required_after:
      - "code-review-passed"
      - "validate-passed"
    validation:
      mandatory: false

  - name: "fetch-issues"
    description: "List open issues for context and task planning"
    mcp_tools:
      - "list_issues"
      - "search_issues"
    inputs:
      - "owner"
      - "repo"
      - "labels"
      - "state: open"
    outputs:
      - "issues_list"
      - "issue_count"
    workflow_phases:
      - "load-context"
      - "brainstorm"
    validation:
      - mandatory: false

  - name: "fetch-prs"
    description: "List pull requests for context"
    mcp_tools:
      - "list_pull_requests"
      - "pull_request_read"
    inputs:
      - "owner"
      - "repo"
      - "state"
    outputs:
      - "prs_list"
    workflow_phases:
      - "load-context"
    validation:
      mandatory: false

  - name: "code-review-comment"
    description: "Add review comments to pull request"
    mcp_tools:
      - "add_comment_to_pending_review"
      - "pull_request_review_write"
    inputs:
      - "owner"
      - "repo"
      - "pull_number"
      - "comments"
    outputs:
      - "review_id"
    workflow_phases:
      - "review"
    validation:
      mandatory: false

  - name: "search-code"
    description: "Search code across repositories for patterns"
    mcp_tools:
      - "search_code"
    inputs:
      - "query"
      - "owner"
      - "repo"
    outputs:
      - "code_matches"
      - "file_paths"
    workflow_phases:
      - "load-context"
      - "brainstorm"
    validation:
      mandatory: false

capabilities:
  - "issue-management"
  - "pull-request-creation"
  - "code-review-automation"
  - "repository-search"
  - "context-loading"

auto_triggers:
  keywords:
    - trigger: ["issue", "bug", "feature request", "create issue"]
      hooks: ["create-issue", "fetch-issues"]
      mandatory: false
    - trigger: ["pull request", "pr", "merge", "create pr"]
      hooks: ["create-pr"]
      mandatory: false
    - trigger: ["review", "code review", "comment"]
      hooks: ["code-review-comment"]
      mandatory: false
    - trigger: ["search code", "find in repo", "grep"]
      hooks: ["search-code"]
      mandatory: false

integration_with_policies:
  - policy: "11.4"
    enforcement: "TRACKING"
    description: "Track GitHub MCP usage to document needs if ≥3 uses"
    violations_fail_workflow: false

fallback_behavior: "If GitHub MCP not available, suggest manual GitHub operations or use gh CLI via Bash"
availability_check: "Check for mcp__github__ prefix in available tools"
