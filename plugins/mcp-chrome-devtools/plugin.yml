/**
 * Policies Applied:
 * - Policy 11.1: MCP-First for Claude Tools
 * - Policy 12.2: Chrome DevTools MCP MANDATORY for UI validation
 * - Policy 3.17: Code documentation
 */

name: "mcp-chrome-devtools"
description: "Chrome DevTools MCP for UI validation, E2E testing, performance audits, and visual regression"
version: "1.0.0"
type: "mcp"

mcp_config:
  server_name: "chrome"
  prefix: "mcp__plugin_superpowers-chrome_chrome__"
  auto_detect: true
  priority: 11

hooks:
  - name: "ui-validation"
    description: "Complete UI validation checklist (console, network, structure, screenshot)"
    mcp_tools:
      - "use_browser"  # action: take_snapshot
      - "use_browser"  # action: screenshot
    inputs:
      - "target_url"
      - "actions: [take_snapshot, screenshot]"
    outputs:
      - "validation_report"
      - "screenshot_path"
      - "console_errors"
      - "network_errors"
    workflow_phases:
      - "validate"
    required_after:
      - "ui_change"
      - "component_change"
    validation:
      mandatory: true
      reason: "Policy 12.2 - MANDATORY UI validation after any UI changes"
      failure_mode: "fail_workflow"

  - name: "console-check"
    description: "Check browser console for errors and warnings"
    mcp_tools:
      - "use_browser"  # action: eval, extract console messages
    inputs:
      - "target_url"
    outputs:
      - "console_messages"
      - "error_count"
      - "warning_count"
    workflow_phases:
      - "validate"
    validation:
      mandatory: true
      reason: "Policy 12.2 - Console must be clean (0 errors)"
      failure_criteria: "error_count > 0"

  - name: "network-check"
    description: "Validate network requests (status codes, failed requests)"
    mcp_tools:
      - "use_browser"  # action: eval, check network
    inputs:
      - "target_url"
    outputs:
      - "network_requests"
      - "failed_requests"
      - "status_codes"
    workflow_phases:
      - "validate"
    validation:
      mandatory: true
      reason: "Policy 12.2 - Network requests must succeed"
      failure_criteria: "failed_requests.length > 0"

  - name: "e2e-test"
    description: "Execute end-to-end user flow test"
    mcp_tools:
      - "use_browser"  # navigate, click, type, wait_for
    inputs:
      - "test_scenario"
      - "steps"
    outputs:
      - "test_result"
      - "errors"
      - "screenshots_per_step"
    workflow_phases:
      - "validate"
    validation:
      mandatory: false

  - name: "performance-audit"
    description: "Measure Core Web Vitals (LCP, FID, CLS) and performance metrics"
    mcp_tools:
      - "use_browser"  # performance tracing
    inputs:
      - "target_url"
    outputs:
      - "lcp"
      - "fid"
      - "cls"
      - "performance_score"
    workflow_phases:
      - "validate"
      - "review"
    validation:
      mandatory: false

  - name: "accessibility-check"
    description: "Check accessibility issues (ARIA, keyboard navigation)"
    mcp_tools:
      - "use_browser"  # snapshot + analyze
    inputs:
      - "target_url"
    outputs:
      - "accessibility_issues"
      - "aria_violations"
    workflow_phases:
      - "validate"
      - "review"
    validation:
      mandatory: false

capabilities:
  - "ui-validation"
  - "e2e-testing"
  - "performance-auditing"
  - "console-monitoring"
  - "network-monitoring"
  - "accessibility-checking"
  - "visual-regression"

auto_triggers:
  keywords:
    - trigger: ["ui", "component", "page", "form", "button", "frontend"]
      hooks: ["ui-validation", "console-check", "network-check"]
      mandatory: true
    - trigger: ["test", "e2e", "user flow", "integration test"]
      hooks: ["e2e-test"]
      mandatory: false
    - trigger: ["performance", "lcp", "fid", "cls", "web vitals"]
      hooks: ["performance-audit"]
      mandatory: false
    - trigger: ["accessibility", "aria", "a11y"]
      hooks: ["accessibility-check"]
      mandatory: false

integration_with_policies:
  - policy: "12.2"
    enforcement: "MANDATORY"
    description: "Chrome DevTools MCP must be used for ALL UI changes"
    violations_fail_workflow: true
    checklist:
      - "Console clean (0 errors)"
      - "Network requests succeed"
      - "UI renders correctly"
      - "No visual regressions"
